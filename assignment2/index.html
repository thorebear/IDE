<!DOCTYPE html>

<html><head>
   <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />   

   <!-- BOOTSTRAP CSS -->
   <!-- Latest compiled and minified CSS -->
   <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap.min.css">
   <!-- JQUERY -->
   <script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>

   <!-- BOOSTRAP JS -->
   <!-- Latest compiled and minified JavaScript -->
   <script type="text/javascript" src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/js/bootstrap.min.js"></script>

   <!-- D3 -->
   <script src="http://d3js.org/d3.v3.min.js" charset="utf-8"></script>

   <style>
   body {
      height: 1000px;
      width: 100%;
   }
   </style>
   
   <!-- Our javascript -->
   <script type="text/javascript">
   d3.select(window).on('load', init);

   data = [];
   
   function init(){
      d3.csv("aalborg.csv", function(error, d) {
         if (error) throw error;

         d.forEach(function(row) {
            data.push(row);
         });

         drawBarChart(data, function(d) { return d.DEC });
      });
   }

   function drawBarChart(data, accessor){
      var values = data.map(accessor).map(parseFloat);
      var num_vals = data.length;
      var max_val = d3.max(values);
      var min_val = d3.min(values);

      // Compute normalized data in range [0,1]
      var norm_vals = values.map(function(d) {
         return (d - min_val) / (max_val - min_val)
      });

      var label_font_size = 14;
      var max_bar_height = getHeight(max_val);
      var bar_width = 20;
      var bar_offset = 2;
      var chart_offset_left = 10;
      var svg_height = max_bar_height + 2 * bar_width;
      
      var svg = d3.select("body")
         .append("svg")
         .attr("height", svg_height)
         .attr("width", chart_offset_left + num_vals*(bar_width+bar_offset) + 10);
      
      svg.selectAll("rect")
         .data(data)
         .enter()
         .append("rect")
         .attr("y", function(d){
            return max_bar_height - getHeight(accessor(d));
         })
         .attr("x", function(d,i){
            return chart_offset_left + i*(bar_width+bar_offset);
         })
         .attr("height", function(d){
            return getHeight(accessor(d));
         })
         .attr("width", bar_width)
         .style('fill', function(d,i) {
            console.log(norm_vals*255);
            return "rgb(" + Math.floor(norm_vals[i] * 255) + "," + 
               "0," +
               "0)"});

      svg.selectAll("text")
         .data(data)
         .enter()
         .append("text")
         .text(function(d){
            return d.YEAR;
         })
         .attr("x",function(d, i)
            {
               return chart_offset_left + i * (bar_width+bar_offset);
            })
         .attr("y",function(d,i)
            {
               if (i%2 === 0){
                  return max_bar_height + 1 * bar_width;
               } 
               else {
                  return max_bar_height + 2 * bar_width;
               }
            }
         )
         .attr("font-size", label_font_size);
      
      function getHeight(val){
         return 120 + parseInt(val)*20;
      };
   };

   </script>
   <title>Interactive Data Exploration - Assigment 2</title>
</head>
<body>
   
</body>
</html>

<!DOCTYPE html>
<html><head>
   <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />   

   <!-- BOOTSTRAP CSS -->
   <!-- Latest compiled and minified CSS -->
   <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap.min.css">
   <!-- JQUERY -->
   <script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>

   <!-- BOOSTRAP JS -->
   <!-- Latest compiled and minified JavaScript -->
   <script type="text/javascript" src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/js/bootstrap.min.js"></script>

   <!-- D3 -->
   <script src="http://d3js.org/d3.v3.min.js" charset="utf-8"></script>

   <style>
   body {
      height: 1000px;
      width: 100%;
   }

   .axis path,
   .axis line {
      fill: none;
      stroke: black;
      shape-rendering: crispEdges;
   }

   .axis text {
      font-family: sans-serif;
      font-size: 13px;
   }
   </style>
   
   <!-- Our javascript -->
   <script type="text/javascript">
   d3.select(window).on('load', init);

   data = [];
   
   function init(){
      d3.csv("copenhagen.csv", function(error, d) {
         if (error) throw error;

         d.forEach(function(row) {
            data.push(row);
         });

         drawBarChart(data, function(d) {
            return (parseFloat(d.JAN) +
               parseFloat(d.FEB) +
               parseFloat(d.MAR) +
               parseFloat(d.APR) +
               parseFloat(d.MAY) +
               parseFloat(d.JUN) +
               parseFloat(d.JUL) +
               parseFloat(d.AUG) +
               parseFloat(d.SEP) +
               parseFloat(d.OCT) +
               parseFloat(d.NOV) +
               parseFloat(d.DEC)) / 12;
         });
      });
   }

   function drawBarChart(data, accessor){
      var svg_width = 600;
      var svg_height = 500;
      var values = data.map(accessor).map(parseFloat);
      console.log(values);
      var num_vals = data.length;
      var max_val = d3.max(values);
      var min_val = d3.min(values);
      console.log("min val: " + min_val);
      console.log("max val: " + max_val);
      var label_font_size = 14;
      var max_bar_height = svg_height*0.8;
      var bar_width = 0.9 * (svg_width / num_vals);
      var bar_offset = 0.1 * (svg_width/ num_vals);
      var chart_offset_left = 30;
      var chart_width = num_vals * (bar_width + bar_offset) - bar_offset;

      // A scale for determine the heigh of svg elements
      var yScale = d3.scale.linear()
         .domain([min_val, max_val])
         .range([10, max_bar_height])
         .nice();

      var yScaleAxis = d3.scale.linear()
         .domain([max_val, min_val])
         .range([10, max_bar_height])
         .nice();

      var xScale = d3.scale.linear()
         .domain([1880,2012])
         .range([0, chart_width]);

      var xAxis = d3.svg.axis()
	 .scale(xScale)
	 .orient("bottom")
         .ticks(14)
         .tickFormat(d3.format("d"));

      var yAxis = d3.svg.axis()
         .scale(yScaleAxis)
         .orient("left")
         .ticks(5);

      // A normilization scale used for color encoding
      var norm_scale = d3.scale.linear()
         .domain([min_val, max_val])
         .range([0,1]);      
      
      var svg = d3.select("body")
         .append("svg")
         .attr("height", svg_height)
         .attr("width", chart_offset_left + num_vals*(bar_width+bar_offset) + 30);
      
      svg.selectAll("rect")
         .data(data)
         .enter()
         .append("rect")
         .attr("y", function(d){
            return max_bar_height - getHeight(accessor(d));
         })
         .attr("x", function(d,i){
            return chart_offset_left + i*(bar_width+bar_offset);
         })
         .attr("height", function(d){
            return getHeight(accessor(d));
         })
         .attr("width", bar_width)
         .style('fill', function(d) {
            return "rgb(" + Math.floor(norm_scale(accessor(d)) * 255) + "," + 
               "0," +
               "0)"
         });

      svg.append("line")
         .attr("x1", chart_offset_left)
         .attr("y1", max_bar_height - getHeight(0))
         .attr("x2", chart_offset_left + chart_width)
         .attr("y2", max_bar_height - getHeight(0))
         .style("stroke", "rgb(0,0,0)")
         .style("stroke-width", 0.5);

      svg.append("g")
         .attr("class", "axis")
         .attr("transform",
            "translate(" + chart_offset_left + "," + max_bar_height + ")")
         .call(xAxis);

      svg.append("g")
         .attr("class", "axis")
         .attr("transform",
            "translate(" + chart_offset_left + "," + 0 + ")")
         .call(yAxis);
   
      function getHeight(val){
         return yScale(val);
      };
   };

   </script>
   <title>Interactive Data Exploration - Assigment 2</title>
</head>
<body>
   
</body>
</html>

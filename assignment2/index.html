<!DOCTYPE html>

<html><head>
   <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />   

   <!-- BOOTSTRAP CSS -->
   <!-- Latest compiled and minified CSS -->
   <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap.min.css">
   <!-- JQUERY -->
   <script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>

   <!-- BOOSTRAP JS -->
   <!-- Latest compiled and minified JavaScript -->
   <script type="text/javascript" src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/js/bootstrap.min.js"></script>

   <!-- D3 -->
   <script src="http://d3js.org/d3.v3.min.js" charset="utf-8"></script>

   <style>
   body {
      height: 1000px;
      width: 100%;
   }
   </style>
   
   <!-- Our javascript -->
   <script type="text/javascript">
   d3.select(window).on('load', init);

   function init(){
      d3.csv("aalborg.csv", function(error, d) {
         if (error) throw error;
         var data = [];         
         d.forEach(function(row) {
            data.push(row);
         });

         onDataLoaded(data, function(d) { return d.DEC });
      });
   }

   function onDataLoaded(data, accessor){
      var num_vals = data.length;
      var max_val = d3.max(data, accessor );
      var min_val = d3.min(data, accessor );
      var max_bar_height = getHeight(max_val);
      var bar_width = 10;
      var bar_offset = 2;
      var chart_offset_left = 10;
      var svg_height = max_bar_height + 30;
      
      var svg = d3.select("body")
         .append("svg")
         .attr("height", svg_height)
         .attr("width", num_vals*(bar_width+bar_offset))
         .selectAll("rect");
      
      svg.data(data)
         .enter()
         .append("rect")
         .attr("y", function(d){
            return max_bar_height - getHeight(accessor(d));
         })
         .attr("x", function(d,i){
            return chart_offset_left + i*(bar_width+bar_offset);
         })
         .attr("height", function(d){
            return getHeight(accessor(d));
         })
         .attr("width", bar_width)
         .style('fill', function(d,i) { 
            return "rgb(" + Math.floor(Math.random()*255) + ", 0, " + Math.floor(Math.random()*255) + ")"});

      d3.select("svg")
         .selectAll("text")
         .data(data)
         .enter()
         .append("text")
         .text(function(d){
            return d.YEAR;
         })
         .attr("x",function(d, i)
            {
               return chart_offset_left + i * (bar_width+bar_offset);
            })
         .attr("y",function(d,i)
            {
               if (i%2 === 0){
                  return max_bar_height + 10;
               } 
               else {
                  return max_bar_height + 20;
               }
            }
         )
         .attr("font-size", 6);
      
      function getHeight(val){
         return 120 + parseInt(val)*20;
      }
   };

   </script>
   <title>Interactive Data Exploration - Assigment 2</title>
</head>
<body>
   
</body>
</html>
